\section{Correlated Equilibria}

Recall the Battle of the Sexes game:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		\textbf{Alice, Bob} & \textbf{Costa} & \textbf{Starbucks} \\ \hline
		\textbf{Costa}      & 3,1            & 0,0 \\ \hline
		\textbf{Starbucks}  & 0,0            & 1,3 \\ \hline
	\end{tabular}
\end{center}

There are two pure Nash Equilibria: (Costa, Costa) and (Starbucks, Starbucks).
The first is unfair to Bob, as he would rather go to Starbucks, while the
second is unfair to Alice as she prefers Costa. There is one mixed Nash
Equilibrium: $((\frac{3}{4}, \frac{1}{4}), (\frac{1}{4}, \frac{3}{4}))$. In
this case Alice and Bob both have expected utility $\frac{3}{4}$ -- this is
good in that it is fair, but bad in that $\frac{3}{4} < 1$, hence they receive
lower expected utility than the minimum they would receive had they just played
a pure strategy. Furthermore, there is a $\frac{3}{4} \cdot \frac{3}{4} +
\frac{1}{4} \cdot \frac{1}{4} = \frac{5}{8}$ probability that they do not meet.
So neither of these solutions are particularly attractive.

Now recall the Game of Chicken:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		\textbf{I, II}    & \textbf{Swerve} & \textbf{Straight} \\ \hline
		\textbf{Swerve}   & 0,0             & -1,1 \\ \hline
		\textbf{Straight} & 1,-1            & -10,-10 \\ \hline
	\end{tabular}
\end{center}

The pure Nash Equilibria are (Straight, Swerve) and (Swerve, Straight), and the
mixed Nash Equilibrium is $((\frac{9}{10}, \frac{1}{10}), (\frac{9}{10},
\frac{1}{10}))$. These are more fair, but still, there is a $\frac{1}{10} \cdot
\frac{1}{10} = 1\%$ chance of a crash, and maybe we aren't in the mood for such
risk. A natural solution is to let each player win with probability, which
avoids all ties and crashes. We want:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		\textbf{I, II}    & \textbf{Swerve} & \textbf{Straight} \\ \hline
		\textbf{Swerve}   & 0\% & 50\% \\ \hline
		\textbf{Straight} & 50\% & 0\% \\ \hline
	\end{tabular}
\end{center}

\subsection{Product Distributions}

Suppose player I plays strategy $s_1 \in S_\text{I}$ with probability $x_1$ and
strategy $s_2 \in S_\text{I}$ with probability $x_2$, and player II plays
strategy $t_1 \in S_\text{II}$ with probability $y_1$ and strategy $t_2 \in
S_\text{II}$ with probability $y_2$. The product distribution is as follows:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		\textbf{I, II} & $y_1$           & $y_2$ \\ \hline
		$x_1$          & $x_1 \cdot y_1$ & $x_1 \cdot y_2$ \\ \hline
		$x_2$          & $x_2 \cdot y_1$ & $x_2 \cdot y_2$ \\ \hline
	\end{tabular}
\end{center}

To be a valid product distribution, we must have that $x_1, x_2, y_1, y_2 \ge
0$, $x_1 + x_2 = 1$, and $y_1 + y_2 = 1$. However, there is no $(x_1, x_2),
(y_1, y_2)$ that satisfies both these conditions and $x_1 y_2 = \frac{1}{2}$,
$x_2 y_1 = \frac{1}{2}$.

We want to design a mechanism/trusted mediator/traffic light that will advise
the players on what to do.

\subsubsection{Example}

Consider the probability distribution on strategy profiles $\sigma = (z_1, z_2,
z_3, z_4)$ such that $\sum_i z_i = 1$ and $z_i \ge 0$:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		\textbf{I, II} & $y_1$ & $y_2$ \\ \hline
		$x_1$          & $z_1$ & $z_2$ \\ \hline
		$x_2$          & $z_3$ & $z_4$ \\ \hline
	\end{tabular}
\end{center}

The traffic light works by showing each player a strategy to follow, and the
players may or may not follow this recommendation. The players know the product
distribution (i.e., the likelihood of ending up in each cell in the table), but
not what strategy the other has been advised to follow.

Is the solution $\sigma = (10\%, 30\%, 40\%, 20\%)$ stable? For clarity let
player I choose between strategies 1 (swerve) and 2 (straight), and player II
choose between strategies $a$ (swerve) and $b$ (straight).  The game is:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		\textbf{I, II} & a     & b \\ \hline
		1              & 0,0   & -1, 1 \\ \hline
		2              & 1, -1 & -10, -10 \\ \hline
	\end{tabular}
\end{center}

With product distribution:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		\textbf{I, II} & a    & b \\ \hline
		1              & 10\% & 30\% \\ \hline
		2              & 40\% & 20\% \\ \hline
	\end{tabular}
\end{center}

Suppose player I is shown the signal 2. We have:

\begin{equation*}
	\begin{split}
		Pr[a|2] = \frac{Pr[a \text{ and } 2]}{Pr[2]} = \frac{40}{40+20}
		= \frac{2}{3} \\
		Pr[b|2] = \frac{Pr[b \text{ and } 2]}{Pr[2]} = \frac{20}{40+20}
		= \frac{1}{3} \\
	\end{split}
\end{equation*}

The expected utilities for player I are as follows:

\begin{equation*}
	\begin{split}
		\mathbb{E}[u_\text{I}(2, (\frac{2}{3}, \frac{1}{3}))] =
		\frac{2}{3} \cdot 1 + \frac{1}{3} \cdot -10 = -\frac{8}{3} \\
		\mathbb{E}[u_\text{I}(1, (\frac{2}{3}, \frac{1}{3}))] =
		\frac{2}{3} \cdot 0 + \frac{1}{3} \cdot -1 = -\frac{1}{3} \\
	\end{split}
\end{equation*}

Hence $\sigma = (10\%, 30\%, 40\%, 20\%)$ is not stable, as player I will not
respect the advice that the traffic light gives it (as strategy 1 has greater
expected utility).

\subsection{Correlated Equilibria}

\begin{definition}[Correlated Equilibrium]
	A joint mixed strategy profile $\sigma \in \Delta_{S_1 \times S_n}$ is
	a correlated equilibrium if for every player $i$ and for all strategies
	$s_i, t_i \in S_i$, we have:
	\begin{equation*}
		\sum_{\vect{x} \in S_{-i}} u_i(\vect{x}, s_i) \cdot
		\sigma(\vect{x}, s_i) \ge \sum_{\vect{x} \in S_{-i}} u_i(\vect{x},
		t_i) \cdot \sigma(\vect{x}, s_i)
	\end{equation*}
\end{definition}

In the above definition, $u_i(\vect{x}, s_i)$ gives the utility to player $i$
if they player $s_i$, given that everyone else plays $\vect{x}$, and
$\sigma(\vect{x}, s_i)$ gives the probability that the traffic light tells
player $i$ to play strategy $s_i$.

\begin{fact}
	If $\sigma^* = (\sigma^*_1, \ldots, \sigma^*_n)$ is a Mixed Nash
	Equilibrium, then $\conj{\sigma}^* \in \Delta^{S_1 \times \ldots \times
	S_n}$ is a Correlated Equilibrium, where

	\begin{equation*}
		\conj{\sigma}^* (s_1, \ldots, s_n) := \sigma^*_1 (s_1) \cdot \ldots
		\cdot \sigma^*_n (s_n) = \prod_i \sigma^*_i(s_i)
	\end{equation*}
\end{fact}

The concept of the Correlated Equilibrium is a generalisation of the Nash
Equilibrium. Nash's Theorem states that every finite game has a Nash
Equilibrium, hence using the above fact every finite game also has a Correlated
Equilibrium.

\begin{proof}[Proof that correlated equilibria always exist]
	Let $\sigma^* = (\sigma^*_1, \ldots, \sigma^*_n)$ be a Nash Equilibrium.
	Then for every $i \in [n]$, for every $s_i \in S_i$, if $\sigma^*_i(s_i) >
	0$ then $s_i$ is a best response to $\sigma^*_{-i}$, i.e. for all $t_i \in
	S_i$, $u_i(\sigma^*_{-i}, s_i) \ge u_i(\sigma^*_{-i}, t_i)$.

	Equivalently, for all players $i \in [n]$ and all $s_i, t_i \in S_i$,
	$\sigma^*_i (s_i) \cdot u_i(\sigma^*_{-i}, s_i) \ge \sigma^*_i (s_i) \cdot
	u_i(\sigma^*_{-i}, t_i)$. By noting that $u_i(\sigma^*_{-i}, s_i) = \sum_{x
	\in S_{-i}} \conj{\sigma}^*_{-i} (x) \cdot u_i(x, s_i)$, we thus get:

	\begin{equation*}
		\sigma^*_i (s_i) \cdot \sum_{x \in S_{-i}} \conj{\sigma}^*_{-i} (x)
		\cdot u_i(x, s_i) \ge \sigma^*_i (s_i) \cdot \sum_{x \in S_{-i}}
		\conj{\sigma}^*_{-i} (x) \cdot u_i(x, t_i)
	\end{equation*}

	This is equivalent to:

	\begin{equation*}
		\sum_{x \in S_{-i}} \conj{\sigma}^* (x) \cdot u_i(x, s_i) \ge
		\sum_{x \in S_{-i}} \conj{\sigma}^* (x) \cdot u_i(x, t_i)
	\end{equation*}

	This is the definition of a correlated equilibrium, hence every finite game
	has a correlated equilibrium as a result of Nash's Theorem.
\end{proof}

\subsubsection{Example}

Recall the game of Chicken:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		\textbf{I, II} & \textbf{3} & \textbf{4} \\ \hline
		\textbf{1}     & 0,0        & -1,1 \\ \hline
		\textbf{2}     & 1,-1       & -10,-10 \\ \hline
	\end{tabular}
\end{center}

With product distribution:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		\textbf{I, II} & \textbf{3} & \textbf{4} \\ \hline
		\textbf{1}     & $z_{11}$   & $z_{12}$ \\ \hline
		\textbf{2}     & $z_{21}$   & $z_{22}$ \\ \hline
	\end{tabular}
\end{center}

For player I:

\begin{equation*}
	\begin{split}
		0 z_{11} - z_{12} & \ge z_{11} -10 z_{12} \\
		z_{21} - 10 z_{22} & \ge 0 z_{21} - z_{22}
	\end{split}
\end{equation*}

For player II:

\begin{equation*}
	\begin{split}
		0 z_{11} - z_{21} & \ge z_{11} -10 z_{21} \\
		z_{12} - 10 z_{22} & \ge 0 z_{12} - z_{22}
	\end{split}
\end{equation*}

A correlated equilibrium can be computed in polynomial time. We can formulate
the problem as a linear program -- for the game of Chicken above we have the
following:

\begin{equation*}
	\begin{split}
		\max_{z_{11}, z_{12}, z_{21}, z_{22}} -20 z_{22} \text{ subject
		to } 0 z_{11} - 1 z_{12} & \ge 1 z_{11} - 10 z_{12} \\
		1 z_{21} - 10 z_{22} & \ge 0 z_{21} - 1 z_{22} \\
		0 z_{11} - 1 z_{21} & \ge 1 z_{11} - 10 z_{21} \\
		1 z_{12} - 10 z_{22} & \ge 0 z_{12} - 1 z_{22} \\
		z_{11} + z_{12} + z_{21} + z_{22} & = 1 \\
		z_{11}, z_{12}, z_{21}, z_{22} & \ge 0 \\
	\end{split}
\end{equation*}

This simplifies to:

\begin{equation*}
	\begin{split}
		\max_{z_{11}, z_{12}, z_{21}, z_{22}} -20 z_{22} \text{ subject
		to } 9 z_{12} & \ge z_{11} \\
		z_{21} & \ge 9 z_{22} \\
		9 z_{21} & \ge z_{11} \\
		z_{12} & \ge 9 z_{22}
	\end{split}
\end{equation*}

The value of -20 arises as a result of the \emph{social utility}, the sum of
all utilities. Note that to maximise the social utility, it is enough to set
$z_{22}$ to 0, meaning the players never crash.
